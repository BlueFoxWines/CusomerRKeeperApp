{"version":3,"sources":["webpack:///./src/components/TinkoffIframeModal.vue?3601","webpack:///./src/views/Order/Pay.vue","webpack:///./src/components/TinkoffIframeModal.vue","webpack:///./src/components/TinkoffIframeModal.vue?82c6","webpack:///./src/views/Order/Pay.vue?a49e"],"names":["class","type","translucent","slot","default-href","$t","fullscreen","pay","Form","Amount","name","rules","ValidationRule","as","field","errors","errorMessage","Object","keys","length","placeholder","disabled","parseInt","$route","query","summ","fillSuggestedAmount","SuggestedAmount","booked","holdsumm","$tc","to","active","IsLoading","is-full-page","title","closeModal","id","src","link","components","IonContent","IonHeader","IonTitle","IonToolbar","IonPage","IonButtons","IonButton","props","String","default","mounted","THIS","this","eventMethod","window","addEventListener","eventer","messageEvent","e","data","message","$router","replace","params","refresh","methods","modal","dismiss","render","__scopeId","yup","number","IonBackButton","Field","Loading","mixins","LoadingState","required","min","PayLink","Method","modalOpen","create","component","TinkoffIframeModal","swipeToClose","componentProps","present","modalClose","switchLoading","$store","dispatch","then","response","PaymentURL","finally"],"mappings":"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","file":"js/chunk-14509418.df11b532.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./TinkoffIframeModal.vue?vue&type=style&index=0&id=627e9161&scoped=true&lang=css\"","<template>\n    <ion-page>\n        <ion-header translucent>\n            <ion-toolbar>\n                <ion-buttons slot=\"start\">\n                    <ion-back-button default-href=\"/main/orders\" />\n                </ion-buttons>\n\n                <ion-title>\n                    <h1 class=\"bluefox-title title\">\n                        {{ $t(\"Interface.Pay.Title\") }}\n                    </h1>\n                </ion-title>\n            </ion-toolbar>\n        </ion-header>\n        <ion-content fullscreen class=\"ion-padding\">\n            <div class=\"pay container\">\n                <Form class=\"form mt-5\" @submit=\"pay\">\n                    <Field\n                        v-slot=\"{ field, errors, errorMessage }\"\n                        v-model=\"Form.Amount\"\n                        name=\"Amount\"\n                        :rules=\"ValidationRule\"\n                        as=\"div\"\n                        class=\"field\"\n                        type=\"number\"\n                    >\n                        <label class=\"label\" :class=\"{ 'has-text-danger': Object.keys(errors).length }\">\n                            <template v-if=\"Object.keys(errors).length\">\n                                {{ errorMessage }}\n                            </template>\n                            <template v-else>\n                                {{ $t(\"Interface.Pay.Amount.Label\") }}\n                            </template>\n                        </label>\n                        <div class=\"control\">\n                            <input\n                                v-bind=\"field\"\n                                class=\"input\"\n                                :class=\"{ 'is-danger': Object.keys(errors).length }\"\n                                :placeholder=\"$t('Interface.Pay.Amount.Placeholder')\"\n                                :disabled=\"(parseInt($route.query.summ, 10) !== 0)\"\n                            >\n                        </div>\n                        <p v-if=\"parseInt($route.query.summ, 10) === 0\" class=\"suggestamount\" @click=\"fillSuggestedAmount\">\n                            {{ SuggestedAmount }} â‚½\n                        </p>\n                    </Field>\n\n                    <p v-if=\"$route.query.booked && $route.query.booked === 'true'\" class=\"pay-holdtext\">\n                        {{ $t(\"Interface.Pay.HoldWarning\") }}\n                    </p>\n                    <p v-if=\"$route.query.holdsumm && parseInt($route.query.holdsumm, 10) > 0 \" class=\"pay-holdtext\">\n                        {{ $tc(\"Interface.Pay.UnholdWarning\", 7, { summ: parseInt($route.query.holdsumm, 10) }) }}\n                    </p>\n\n                    <hr>\n\n                    <div class=\"control\">\n                        <button type=\"submit\" class=\"button is-theme is-fullwidth\">\n                            {{ $t(\"Interface.Pay.Button\") }}\n                        </button>\n                    </div>\n\n                    <p class=\"bluefox-text is-underbutton\">\n                        {{ $t(\"Interface.Pay.OfferText\") }}\n                        <router-link\n                            :to=\"{ name: 'PublicOffer' }\"\n                            class=\"link\"\n                        >\n                            {{ $t(\"Interface.Pay.OfferLink\") }}\n                        </router-link>\n                    </p>\n\n                    <div v-if=\"!$route.query.booked\" class=\"has-text-centered\">\n                        <br>\n                        <router-link\n                            :to=\"{ name: 'Orders' }\"\n                            class=\"button is-text\"\n                        >\n                            {{ $t(\"Interface.Pay.PayAtRestaurant\") }}\n                        </router-link>\n                    </div>\n                </Form>\n            </div>\n        </ion-content>\n        <loading :active=\"IsLoading\" :is-full-page=\"true\" />\n    </ion-page>\n</template>\n\n<script>\nimport {\n    IonPage,\n    IonContent,\n    IonButtons,\n    IonBackButton,\n    IonHeader,\n    IonToolbar,\n    IonTitle,\n    modalController\n} from \"@ionic/vue\"\nimport { number } from \"yup\"\nvar yup = { number }\nimport { Field, Form } from \"vee-validate\"\nimport LoadingState from \"@/mixins/LoadingState\"\nimport Loading from \"@/components/Loading.vue\"\nimport TinkoffIframeModal from \"@/components/TinkoffIframeModal.vue\"\nimport {\n    ORDER_PAY_TINKOFFWEB_REQUEST\n} from \"@/store/actions/order\"\n\nexport default {\n    name: \"Pay\",\n    components: {\n        IonContent,\n        IonPage,\n        IonButtons,\n        IonBackButton,\n        IonHeader,\n        IonToolbar,\n        IonTitle,\n        Field,\n        Form,\n        Loading\n    },\n    mixins: [LoadingState],\n    data() {\n        return {\n            ValidationRule: yup.number().required().min(\n                (parseInt(this.$route.query.summ, 10) !== 0)\n                    ? parseInt(this.$route.query.summ, 10)\n                    : 2000\n            ),\n            PayLink: null,\n            SuggestedAmount: 2000,\n            Form: {\n                Amount: (parseInt(this.$route.query.summ, 10) !== 0)\n                    ? parseInt(this.$route.query.summ, 10)\n                    : null,\n                Method: null\n            }\n        }\n    },\n    methods: {\n        fillSuggestedAmount() {\n            this.Form.Amount = this.SuggestedAmount\n        },\n        async modalOpen() {\n            if (this.PayLink) {\n                const modal = await modalController\n                    .create({\n                        component: TinkoffIframeModal,\n                        swipeToClose: true,\n                        componentProps: {\n                            title: this.$t(\"Interface.Pay.Method.Card.Tinkoff\"),\n                            link: this.PayLink\n                        }\n                    })\n                return modal.present()\n            }\n        },\n        async modalClose() {\n            const modal = await modalController\n            return modal.dismiss()\n        },\n        pay() {\n            this.switchLoading()\n            this.$store.dispatch(ORDER_PAY_TINKOFFWEB_REQUEST, {\n                \"OrderId\": parseInt(this.$route.params.id, 10),\n                \"Sum\": parseInt(this.Form.Amount, 10)\n            })\n                .then((response) => {\n                    this.PayLink = response.data.PaymentURL\n                    this.modalOpen()\n                })\n                .finally(() => this.switchLoading())\n        }\n    }\n}\n</script>\n","<template>\n    <ion-page>\n        <ion-header>\n            <ion-toolbar>\n                <ion-title>{{ title }}</ion-title>\n                <ion-buttons slot=\"start\">\n                    <ion-button @click=\"closeModal\">\n                        {{ $t(\"Interface.Button.Close\") }}\n                    </ion-button>\n                </ion-buttons>\n            </ion-toolbar>\n        </ion-header>\n        <ion-content class=\"ion-padding\">\n            <iframe id=\"myIFrame\" :src=\"link\" />\n        </ion-content>\n    </ion-page>\n</template>\n\n<script>\nimport {\n    IonContent,\n    IonHeader,\n    IonTitle,\n    IonToolbar,\n    IonPage,\n    IonButtons,\n    IonButton,\n    modalController\n} from \"@ionic/vue\"\nimport { defineComponent } from \"vue\"\nimport notify from \"@/utils/Notifications\"\n\nexport default defineComponent({\n    name: \"TinkoffIframeModal\",\n    components: {\n        IonContent,\n        IonHeader,\n        IonTitle,\n        IonToolbar,\n        IonPage,\n        IonButtons,\n        IonButton\n    },\n    props: {\n        title: {\n            type: String,\n            default: \"Modal\"\n        },\n        link: {\n            type: String,\n            default: null\n        }\n    },\n    mounted() {\n        const THIS = this\n        var eventMethod = window.addEventListener\n            ? \"addEventListener\"\n            : \"attachEvent\"\n        var eventer = window[eventMethod]\n        var messageEvent = eventMethod === \"attachEvent\"\n            ? \"onmessage\"\n            : \"message\"\n\n        eventer(messageEvent, function (e) {\n            if (e.data === \"success\" || e.message === \"success\") {\n                notify(\"success\", THIS.$t(\"Message.Payment.Success\"))\n                THIS.closeModal()\n                THIS.$router.replace({\n                    name: \"Orders\",\n                    params: { refresh: true }\n                })\n            }\n            else if (e.data === \"fail\" || e.message === \"fail\") {\n                notify(\"danger\", THIS.$t(\"Message.Payment.Fail\"))\n                THIS.closeModal()\n            }\n        })\n    },\n    methods: {\n        async closeModal() {\n            const modal = await modalController\n            return modal.dismiss()\n        }\n    }\n})\n</script>\n\n<style scoped>\n    ion-content {\n        height: 100vh;\n    }\n    iframe {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n    }\n</style>\n","import { render } from \"./TinkoffIframeModal.vue?vue&type=template&id=627e9161&scoped=true\"\nimport script from \"./TinkoffIframeModal.vue?vue&type=script&lang=js\"\nexport * from \"./TinkoffIframeModal.vue?vue&type=script&lang=js\"\n\nimport \"./TinkoffIframeModal.vue?vue&type=style&index=0&id=627e9161&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-627e9161\"\n\nexport default script","import { render } from \"./Pay.vue?vue&type=template&id=12753078\"\nimport script from \"./Pay.vue?vue&type=script&lang=js\"\nexport * from \"./Pay.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script"],"sourceRoot":""}