{"version":3,"sources":["webpack:///./src/components/TinkoffIframeModal.vue?e723","webpack:///./src/views/Order/Pay.vue","webpack:///./src/components/TinkoffIframeModal.vue","webpack:///./src/components/TinkoffIframeModal.vue?8258","webpack:///./src/views/Order/Pay.vue?7aaf"],"names":["class","type","translucent","slot","default-href","$t","fullscreen","pay","Form","Amount","name","rules","ValidationRule","as","field","errors","errorMessage","Object","keys","length","placeholder","fillSuggestedAmount","SuggestedAmount","to","$route","query","booked","active","IsLoading","is-full-page","title","closeModal","id","src","link","components","IonContent","IonHeader","IonTitle","IonToolbar","IonPage","IonButtons","IonButton","props","String","default","mounted","THIS","this","eventMethod","window","addEventListener","eventer","messageEvent","e","data","message","$router","replace","params","refresh","methods","modal","dismiss","render","__scopeId","yup","number","IonBackButton","Field","Loading","mixins","LoadingState","required","min","PayLink","Method","modalOpen","create","component","TinkoffIframeModal","swipeToClose","componentProps","present","modalClose","switchLoading","$store","dispatch","parseInt","then","response","PaymentURL","finally"],"mappings":"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","file":"js/chunk-4894dd62.8810bac2.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./TinkoffIframeModal.vue?vue&type=style&index=0&id=627e9161&scoped=true&lang=css\"","<template>\r\n    <ion-page>\r\n        <ion-header translucent>\r\n            <ion-toolbar>\r\n                <ion-buttons slot=\"start\">\r\n                    <ion-back-button default-href=\"/main/orders\" />\r\n                </ion-buttons>\r\n\r\n                <ion-title>\r\n                    <h1 class=\"bluefox-title title\">\r\n                        {{ $t(\"Interface.Pay.Title\") }}\r\n                    </h1>\r\n                </ion-title>\r\n            </ion-toolbar>\r\n        </ion-header>\r\n        <ion-content fullscreen class=\"ion-padding\">\r\n            <div class=\"container\">\r\n                <Form class=\"form mt-5\" @submit=\"pay\">\r\n                    <Field\r\n                        v-slot=\"{ field, errors, errorMessage }\"\r\n                        v-model=\"Form.Amount\"\r\n                        name=\"Amount\"\r\n                        :rules=\"ValidationRule\"\r\n                        as=\"div\"\r\n                        class=\"field\"\r\n                        type=\"number\"\r\n                    >\r\n                        <label class=\"label\" :class=\"{ 'has-text-danger': Object.keys(errors).length }\">\r\n                            <template v-if=\"Object.keys(errors).length\">\r\n                                {{ errorMessage }}\r\n                            </template>\r\n                            <template v-else>\r\n                                {{ $t(\"Interface.Pay.Amount.Label\") }}\r\n                            </template>\r\n                        </label>\r\n                        <div class=\"control\">\r\n                            <input\r\n                                v-bind=\"field\"\r\n                                class=\"input\"\r\n                                :class=\"{ 'is-danger': Object.keys(errors).length }\"\r\n                                :placeholder=\"$t('Interface.Pay.Amount.Placeholder')\"\r\n                            >\r\n                        </div>\r\n                        <p class=\"suggestamount\" @click=\"fillSuggestedAmount\">\r\n                            {{ SuggestedAmount }} â‚½\r\n                        </p>\r\n                    </Field>\r\n\r\n                    <hr>\r\n\r\n                    <div class=\"control\">\r\n                        <button type=\"submit\" class=\"button is-theme is-fullwidth\">\r\n                            {{ $t(\"Interface.Pay.Button\") }}\r\n                        </button>\r\n                    </div>\r\n\r\n                    <p class=\"bluefox-text is-underbutton\">\r\n                        {{ $t(\"Interface.Pay.OfferText\") }}\r\n                        <router-link\r\n                            :to=\"{ name: 'PublicOffer' }\"\r\n                            class=\"link\"\r\n                        >\r\n                            {{ $t(\"Interface.Pay.OfferLink\") }}\r\n                        </router-link>\r\n                    </p>\r\n\r\n                    <div v-if=\"!$route.query.booked\" class=\"has-text-centered\">\r\n                        <br>\r\n                        <router-link\r\n                            :to=\"{ name: 'Orders' }\"\r\n                            class=\"button is-text\"\r\n                        >\r\n                            {{ $t(\"Interface.Pay.PayAtRestaurant\") }}\r\n                        </router-link>\r\n                    </div>\r\n                </Form>\r\n            </div>\r\n        </ion-content>\r\n        <loading :active=\"IsLoading\" :is-full-page=\"true\" />\r\n    </ion-page>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n    IonPage,\r\n    IonContent,\r\n    IonButtons,\r\n    IonBackButton,\r\n    IonHeader,\r\n    IonToolbar,\r\n    IonTitle,\r\n    modalController\r\n} from \"@ionic/vue\"\r\nimport { number } from \"yup\"\r\nvar yup = { number }\r\nimport { Field, Form } from \"vee-validate\"\r\nimport LoadingState from \"@/mixins/LoadingState\"\r\nimport Loading from \"@/components/Loading.vue\"\r\nimport TinkoffIframeModal from \"@/components/TinkoffIframeModal.vue\"\r\nimport {\r\n    ORDER_PAY_TINKOFFWEB_REQUEST\r\n} from \"@/store/actions/order\"\r\n\r\nexport default {\r\n    name: \"Pay\",\r\n    components: {\r\n        IonContent,\r\n        IonPage,\r\n        IonButtons,\r\n        IonBackButton,\r\n        IonHeader,\r\n        IonToolbar,\r\n        IonTitle,\r\n        Field,\r\n        Form,\r\n        Loading\r\n    },\r\n    mixins: [LoadingState],\r\n    data() {\r\n        return {\r\n            ValidationRule: yup.number().required().min(2000),\r\n            PayLink: null,\r\n            SuggestedAmount: 2000,\r\n            Form: {\r\n                Amount: null,\r\n                Method: null\r\n            }\r\n        }\r\n    },\r\n    methods: {\r\n        fillSuggestedAmount() {\r\n            this.Form.Amount = this.SuggestedAmount\r\n        },\r\n        async modalOpen() {\r\n            if (this.PayLink) {\r\n                const modal = await modalController\r\n                    .create({\r\n                        component: TinkoffIframeModal,\r\n                        swipeToClose: true,\r\n                        componentProps: {\r\n                            title: this.$t(\"Interface.Pay.Method.Card.Tinkoff\"),\r\n                            link: this.PayLink\r\n                        }\r\n                    })\r\n                return modal.present()\r\n            }\r\n        },\r\n        async modalClose() {\r\n            const modal = await modalController\r\n            return modal.dismiss()\r\n        },\r\n        pay() {\r\n            this.switchLoading()\r\n            this.$store.dispatch(ORDER_PAY_TINKOFFWEB_REQUEST, {\r\n                \"OrderId\": parseInt(this.$route.params.id, 10),\r\n                \"Sum\": parseInt(this.Form.Amount, 10)\r\n            })\r\n                .then((response) => {\r\n                    this.PayLink = response.data.PaymentURL\r\n                    this.modalOpen()\r\n                })\r\n                .finally(() => this.switchLoading())\r\n        }\r\n    }\r\n}\r\n</script>\r\n","<template>\r\n    <ion-page>\r\n        <ion-header>\r\n            <ion-toolbar>\r\n                <ion-title>{{ title }}</ion-title>\r\n                <ion-buttons slot=\"start\">\r\n                    <ion-button @click=\"closeModal\">\r\n                        {{ $t(\"Interface.Button.Close\") }}\r\n                    </ion-button>\r\n                </ion-buttons>\r\n            </ion-toolbar>\r\n        </ion-header>\r\n        <ion-content class=\"ion-padding\">\r\n            <iframe id=\"myIFrame\" :src=\"link\" />\r\n        </ion-content>\r\n    </ion-page>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n    IonContent,\r\n    IonHeader,\r\n    IonTitle,\r\n    IonToolbar,\r\n    IonPage,\r\n    IonButtons,\r\n    IonButton,\r\n    modalController\r\n} from \"@ionic/vue\"\r\nimport { defineComponent } from \"vue\"\r\nimport notify from \"@/utils/Notifications\"\r\n\r\nexport default defineComponent({\r\n    name: \"TinkoffIframeModal\",\r\n    components: {\r\n        IonContent,\r\n        IonHeader,\r\n        IonTitle,\r\n        IonToolbar,\r\n        IonPage,\r\n        IonButtons,\r\n        IonButton\r\n    },\r\n    props: {\r\n        title: {\r\n            type: String,\r\n            default: \"Modal\"\r\n        },\r\n        link: {\r\n            type: String,\r\n            default: null\r\n        }\r\n    },\r\n    mounted() {\r\n        const THIS = this\r\n        var eventMethod = window.addEventListener\r\n            ? \"addEventListener\"\r\n            : \"attachEvent\"\r\n        var eventer = window[eventMethod]\r\n        var messageEvent = eventMethod === \"attachEvent\"\r\n            ? \"onmessage\"\r\n            : \"message\"\r\n\r\n        eventer(messageEvent, function (e) {\r\n            if (e.data === \"success\" || e.message === \"success\") {\r\n                notify(\"success\", THIS.$t(\"Message.Payment.Success\"))\r\n                THIS.closeModal()\r\n                THIS.$router.replace({\r\n                    name: \"Orders\",\r\n                    params: { refresh: true }\r\n                })\r\n            }\r\n            else if (e.data === \"fail\" || e.message === \"fail\") {\r\n                notify(\"danger\", THIS.$t(\"Message.Payment.Fail\"))\r\n                THIS.closeModal()\r\n            }\r\n        })\r\n    },\r\n    methods: {\r\n        async closeModal() {\r\n            const modal = await modalController\r\n            return modal.dismiss()\r\n        }\r\n    }\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n    ion-content {\r\n        height: 100vh;\r\n    }\r\n    iframe {\r\n        position: absolute;\r\n        top: 0;\r\n        left: 0;\r\n        width: 100%;\r\n        height: 100%;\r\n    }\r\n</style>\r\n","import { render } from \"./TinkoffIframeModal.vue?vue&type=template&id=627e9161&scoped=true\"\nimport script from \"./TinkoffIframeModal.vue?vue&type=script&lang=js\"\nexport * from \"./TinkoffIframeModal.vue?vue&type=script&lang=js\"\n\nimport \"./TinkoffIframeModal.vue?vue&type=style&index=0&id=627e9161&scoped=true&lang=css\"\nscript.render = render\nscript.__scopeId = \"data-v-627e9161\"\n\nexport default script","import { render } from \"./Pay.vue?vue&type=template&id=e183f61a\"\nimport script from \"./Pay.vue?vue&type=script&lang=js\"\nexport * from \"./Pay.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script"],"sourceRoot":""}